<!DOCTYPE html>
<html>
<head>
    <title>Создать новую тему</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; }
        form div { margin-bottom: 15px; }
        input[type="text"], textarea { width: 100%; padding: 8px; }
        textarea { height: 150px; }
        button { padding: 10px 20px; background: #0066cc; color: white; border: none; }
    </style>
</head>
<body>
    <h1>Создать новую тему</h1>
    
    <form method="POST" action="/api/forums">
        <div>
            <label>Название:</label>
            <input type="text" name="title" required>
        </div>
        <div>
            <label>Описание:</label>
            <textarea name="description"></textarea>
        </div>
        <button type="submit">Создать</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatContainer = document.getElementById('mini-chat');
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-message');
            const sendButton = document.getElementById('send-message');
            const toggleButton = document.getElementById('toggle-chat');
            
            // Получаем имя пользователя (можно изменить на реальное)
            const username = localStorage.getItem('chat-username') || 
                             'User' + Math.floor(Math.random() * 1000);
            
            // Подключение WebSocket
            const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
            const ws = new WebSocket(`${protocol}${window.location.host}/ws/global-chat`);
            
            // Обработчик сообщений
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                const messageElement = document.createElement('div');
                messageElement.className = 'message';
                messageElement.innerHTML = `
                    <div class="message-author">${escapeHtml(data.author)}:</div>
                    <div class="message-content">${escapeHtml(data.message)}</div>
                    <div class="message-time" style="font-size:12px;color:#666">
                        ${new Date().toLocaleTimeString()}
                    </div>
                `;
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            };
            
            // Отправка сообщения
            function sendMessage() {
                const message = chatInput.value.trim();
                if (message && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({
                        author: username,
                        message: message
                    }));
                    chatInput.value = '';
                }
            }
            
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
            
            // Сворачивание/разворачивание чата
            toggleButton.addEventListener('click', function() {
                chatContainer.classList.toggle('chat-collapsed');
                toggleButton.textContent = chatContainer.classList.contains('chat-collapsed') ? '+' : '−';
            });
            
            // Экранирование HTML
            function escapeHtml(text) {
                return text
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
            }
        });
    </script>
</body>
</html>